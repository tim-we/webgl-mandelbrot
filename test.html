<!doctype html>
<html>
  <head>
    <title>WebGL Demo</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="../webgl.css" type="text/css">
    <script src="sylvester.js" type="text/javascript"></script>
    <script src="glUtils.js" type="text/javascript"></script>
    <script src="webgl-test.js" type="text/javascript"></script>

    <!-- Fragment shader program -->
	
    <script id="shader-fs" type="x-shader/x-fragment">
		precision highp float;
		
		uniform float p;
		
		varying float real;
		varying float img;
		
		const int N = 60;
		const float boostFactor = 1.25;
		
        void main(void) {
		
			float alpha;
			float radius2;
			
			float a = real;
			float b = img;
			
			float len;
			
			for(int i = 0; i < N; i++) {
				radius2 = pow(a*a + b*b, 0.5 * p);
				alpha = p * atan(b,a);
				
				a = radius2 * cos(alpha) + real;
				b = radius2 * sin(alpha) + img;
				
				len = a*a + b*b;
				
				if(len > 2.0) {
					float c = boostFactor * float(i)/float(N);
					gl_FragColor = vec4(0.1*c, 0.42*c, c, 1.0);
					return;
				}
			}
			
			gl_FragColor = vec4(1.0,1.0,1.0,1.0);
        }
    </script>

    <!-- Vertex shader program -->

    <script id="shader-vs" type="x-shader/x-vertex">
		attribute vec3 aVertexPosition;

		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;

		varying float real;
		varying float img;

		void main(void) {
			real = 1.0 * aVertexPosition.x;
			img = 1.0 * aVertexPosition.y;
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
		}
    </script>
  </head>

  <body onload="start()">
    <canvas id="glcanvas" width="800" height="600">
      Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
    </canvas>
  </body>
</html>